# 대규모 트래픽으로 인한 서버 과부하 해결 방법

## 서킷 브레이커
- 외부 서비스의 장애로 인한, 연쇄적 장애 전파를 막기 위해 자동으로 외부 서비스와 연결을 차단 및 복구하는 것  
 ex) 장바구니 -> 서킷브레이커 -> 주문 -> 서킷 브레이커 -> 결제

- 보통 MSA에서 서킷 브레이커 장착

- 서킷 브레이커를 서비스 사이에 넣고 관련함수 랩핑함.  
  timeout으로 설정된 시간 초과-> 장애 인식 -> 서킷 브레이커 trip -> 추가적 호출 발생 되지 않게 한다.

### 서킷 브레이커 상태
- closed : 네트워크 요청의 실패율이 임계치보다 낮음 정상
- open : 임계치이상의 상태, 요청을 전송 하지 않고 바로 오류 변환
- half_open : open 상태에서 일정 timeout 설정 시간이 지나면,  
  장애가 해결 되었는지 확인 하기 위해 half_open 상태로 전환,  
  요청 전송시, 응답 확인, 장애가 풀리는지 확인, 성공하면 closed, 실패시 open 으로 변경
- 실패 허용 전략 : 에러의 연쇄 발생을 막는다.

### 컨텐츠 확인

1. 불필요한 컨텐츠 제거  
    - 불필요한 데이터 로드를 방지

2. CDN을 통한 컨텐츠 제공

3. 컨텐츠 캐싱  
    - 브라우저 캐시를 통해 요청에 관한 항목을  
      캐시에서 응답을 읽어 네트워크 요청에 관한 비용 모두 제거

4. 컨텐츠 압축  
     - 텍스트 기반 리소스는 gzip, Broti를 통해 압축  
       단, 압축 푸는 자원 사용 양까지 고려해야함

5. 컨텐츠의 우아한 저하(미리 준비된 응답)
     - 정적 텟트스 페이제 제공
     - 검색 비활성화
     - 적은 수의 검색 결과 반환
     - 필수적이지 않은 기능 비활성화


