# 가상메모리, 스와핑, 페이지 폴트 그리고 스레싱


## 가상메모리

- 메모리 관리 기법의 하나
- 실제 이용 가능한 메모리 자원을 추상화
- 이용자에게 메모리 용량을 큰 것 처럼 만드는 것
- 물리적 메모리 부족 보완
- 큰 메모리 기반, 멀티태스킹 가능
- 가상 주소 : 가상 메모리 주소(logical/virtual address)
- 실제 주소 : 실제 메모리 주소(physical address)
- 가상 주소는 메모리 장치(MMU)에 의해 실제 주소로 변환, 이용자는 실제주소 의식 할 필요 없음
- 가상 주소와 실제 주소가 매핑된, 페이지 테이블로 관리
- 속도 향상을 위해 TLB 사용
    - TLB : 메모리와 CPU 사이의 주소 변환을 위한 캐시
- 페이지 테이블의 리스트 보관
- CPU가 페이지 테이블까지 가지 않도록 해, 속도 향상을 시킬 수 있는 캐시 계층

## 스와핑

- 가상 메모리에는 존재하나 , 실제 메모리인 RAM에는 없는 데이터나 코드에 접근 시, 페이지 폴트 발생
- 메모리의 사용하지 않는 영역을 하드 디스크로 이동
- 하드디스크의 일부를 마치 메모리처럼 불러와 쓰는 것  
  (하드디스크 <-> 메모리) -> 스와핑
- 페이지 : 가상 메모리 사용의 최소 크기단위
- 프레임 : 실제 메모리를 사용의 최소 크기 단위

## 페이지 폴트

1. 프로세스의 주소 공간에는 존재, 하지만 RAM에는 없는 데이터 접근시 발생함
2. 스와핑 발생
    1. CPU 물리 메모리 확인, 해당 페이지 없으면 트랩 발생 운영체제에 알림
    2. 운영체제는 CPU 동작 멈춤
    3. 페이지 테이블 확인 메모리의 페이지에 존재 유무확인
    4. 없으면 프로세스 중단, 메모리에 비어있는 프레임이 있는지 찾음, 물리 메모리에도 없으면 스와핑 발동
    5. 비어 있는 프레임에 해당 페이지 로드
    6. 페이지 테이블 최신화
    7. 중단된 CPU를 다시 시작

## 스레싱

- 메모리의 페이지 폴트율을 높은 것을 의미
- 심각한 성능 저하 발생
- 발생원인
    1. 메모리에 너무 많은 프로세스 동시 올라감
    2. 스와핑이 너무 많이 발생
    3. CPU 이용률 낮아짐
    4. 운영체제는 CPU의 이용률을 높이기 위해 더 많은 프로세스를 메모리에 올림

- 해결방법
    1. HDD -> SDD 변경
    2. 메모리 늘림

- 운영체제에서 해결방법

    1. 작업세트(WORK SET)
        - 프로세스 과거 사용 이력인 지역성(locality)를 통해 결정된 페이지 집합을 만들어 미리 메모리에 로드  
          탐색 비용을 줄이고 스와핑 줄일 수 있음
    2. PFF
        - 페이지 폴트 빈도(Page Fault Frequency ) 조절 방법
        - 상한선, 하한선을 만들어, 해당 선에 도달시 프레임을 줄이거나 늘리는것
