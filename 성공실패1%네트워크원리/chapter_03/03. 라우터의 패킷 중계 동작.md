### 1. 라우터의 기본

- 라우터의 내부 구조
  1. 중계 부분 : 중계 대상을 판단하는 동작
  2. 포트 부분 : 패킷을 송 수신 하는 동작

- 포트 부분에서 패킷을 수신(이더넷 규칙 또는 무선 LAN 규칙, 통신회선 규칙대로 동작)

  1. 포트부분의 하드웨어에 의뢰, 패킷을 수신
  2. 중계 부분에서 받은 패킷의 IP패킷에 기록되어있는 IP주소, 중계 대상 등록표 대조, 중계대상 판단
  3. 중계 대상 측 포트로 패킷을 옮기고, 포트부분의 하드웨어 규칙에 따라 패킷 송신 동작 실행

- 스위칭 허브는 들어온 패킷을 전송하기만 하고, 송신처나, 수신처가 되지 않는다.

- 라우터의 각 포트에는 MAC 주소와 IP 주소가 할당 되어있다.

### 2. 경로 표에 등록된 정보

- 라우터의 중계 대상은 수신처 IP주소로 판단한다.

- 라우터 테이블은 라우팅 테이블, 또는 경로표라고 표현.

- 라우터는 라우팅 테이블에서, 호스트 번호 무시하고 네트워크 번호 부분만 조사한다.

- 라우터는 호스트 번호를 무시하고 네트워크 번호 부분만 조사한다.

- 라우팅 테이블 내용 
  1. 수신처: 수신처 IP 주소 
    - 라우터는 이 수신처 IP 주소와 패킷의 IP주소를 비교, 행이 맞는지 판단 단, 호스트 번호는 무시한다.
    - 서브넷을 나타내는 IP주소가 등록되어있지 않을 수도 있음. -> 주소 집약
      - 주소 집약 : 몇개의 서브넷을 모아서 한개의 서브넷으로 간주, 묶을 서브넷을 경로표에 등록할 수 있다.
        (서브넷 구성 하는 PC들이 공통의 라우터로 중계 될 때, 수신처 IP도 공통의 라우터의 IP주소로 사용)  
      - 주소 집약과 반대 되는 경우도 존재함.

  2. 넷마스크 : 네트워크 번호의 비트수를 판단 하기 위한 항목
  3. 게이트 웨이 : 중계 대상의 IP주소
  4. 인터페이스 : 중계 대상의 포트
  5. 매트릭 : 목적지가 가까운지 먼지를 나타낸다.

- 라우터 경로 정보 등록 방법
  1. 사람이 수동으로 경로 정보 등록/갱신
  2. 라우팅 프로토콜이라는 구조 사용, 라우터들 끼리 경로 정보를 교환, 라우터 자체에서 경로표 등록(RIP, OSPF, BGP 프로토콜 이용)

### 3. 라우터 패킷 수신 동작

1. 신호 커넥터 부분에 도착
2. PHY(MAU)회로, MAC회로에서 신호를 디지털 신호로 변환
3. FCS 대조, 오류 유무 점검
4. MAC 헤더의 수신처 및 MAC 주소가 자신에게 해당 하는지 조사
5. 해당시, 버퍼메모리에 데이터 저장 (해당 안하면 폐기)

### 4. 경로표를 검색, 출력 포트를 발견한다.

- 라우터는 수신 동작이 끝나면 패킷의 MAC 헤더를 폐기한다.

- MAC 헤더의 역할은 라우터에 패킷을 건네 주는것.( 건네주는것을 종료하면, 역할이 끝나는것)

- IP 헤더의 내용을 보고 패킷 중계 동작 들어감

- 중계 대상 조사시, ROUTE TABLE의 수신한 패킷의 수신처 IP주소와 경로표의 수신처 항목을 조사, 해당하는 행을 찾음

- 넷마크스의 값에서 네트워크 비트 수를 판단, 네트워크 번호 부분만 비교한다.

- 네트워크 번호의 길이가 같은것이 여러행 존재하는 경우, 메트릭으로 판단(가까운 쪽, 값이 작은 쪽으로 중계 대상을 선택)

- 행이 하나도 존재 하지 않을시, 패킷 폐기, ICMP 메시지로 송신처에 사실 통지


### 5. 해당 경로가 없는 경우에 선택하는 기본 경로

- 라우터에 중계 대상을 전부 등록해야 할시, 수신처와 넷마스크를 0.0.0.0으로 설정 모든 주소를 일치시켜 불일치하는 상황을 발생시키지 않는다.

- 라우터의 경로표에 넷마스트 항목의 0.0.0.0인 행은 기본 경로를 나타낸다.

- 기본 경로에 등록한 라우터를 기본 게이트 웨이라고 한다.

### 6. 패킷은 유효기간이 있다.

- TTL(Time To Live, 생존기간) : 라우터를 경유 할때마다 해당 값을 줄어듬, 0이 되면 패킷을 폐기한다.

- 송신처가 가 처음 패킷을 송신 할때, 64 또는 128값을 설정한다.

### 7. 큰 패킷은 조각 나누기 기능으로 분할 한다.

- 회선이나 LAN의 종류에 따라서, 패킷의 최대길이는 달라진다. 

- 최대 길이를 초과하면 그대로 패킷을 송신 할 수 없다.

- 조각 나누기 : 패킷을 분할하고, 패킷의 길이를 짧게 만든후 중계 한다.

- 조각 나누기 과정
  1. MTU (송신데이터 최대길이) 조사(송신 유무 확인) - 패킷의 최대길이는 포트의 종류에 따라 결정
  2. 중계 패킷 길이와 비교
  3. MTU가 충분 -> 송신
  4. MTU가 충분X -> 헤더 조사 (분할 가능유무 조사)
  5. 가능할시, 분할
  6. 불가능 할시, 폐기 -> ICMP 전송


### 8. 라우터의 송신 동작은 컴퓨터와 같다.

- 송신 동작은 포트에 따라 다름, 포트에 따라 신호를 변환하여 송신한다 ex) ADSL, 이더넷, 가정용LAN 등..

- 라우터가 다음에 건네줄 상대를 판단하는 방법
  - 경로표의 '게이트 웨이' 항목에 IP 주소가 쓰여있으면 IP 주소가 건네 줄 상대
  - 경로표의 '게이트 웨이' 항목이 공란이면 IP헤더의 수신처 IP 주소가 건네줄 상태

- 라우터도 ARP를 사용하여 다음 건네줄 상대의 MAC주소를 알아낸다.

- 송신처 MAC주소 에는 출력측 포트의 MAC주소를 넣는다.

- 반이중 또는 전이중 모드로 신호 송신한다.

### 9. 라우터와 스위칭 허브의 관계

- IP구조(라우터)는 스스로 패킷을 운반하는 수단이 없으므로, 패킷을 운반할땐, 이더넷(허브)에 의뢰하여 운반한다.
  (패킷 전달하는 전체 동작은 ip(라우터)가 수행, 단 다음 라우터 까지 운반 역할만, 이더넷(스위칭 허브)가 한다)

- IP가 의뢰하는것은, 목적지까지가 아닌, 다음 라우터에 패킷을 운반하는 것.

- 패킷 운반의 역할은 바뀔수 있다.
  ex) 라우터 + 무선 LAN 일시, 라우터라 무선LAN에 패킷 운반을 의뢰한다.
