### 1. 프로토콜 스택에 HTTP 리퀘스트 메시지를 넘긴다.

- 어플리케이션이 write를 호출 하여 송신데이터를 프로토콜 스택에 건네주는 곳부터 시작

- 프로토콜 스택은 받은 데이터를 바로 송신 안하고, 어느정도 데이터가 저장 되면 송수신 동작한다.

- 프로토콜 스택의 송수신 동작을 위한 판단 요소  
  
  1. 데이터의 양     
    - MTU : 한패킷으로 운반 할 수 있는 디지털 데이터의 최대길이. 이더넷에선 1500 바이트  
    - MSS : MTU에서 헤더를 제외하고 패킷으로 운반 할 수 있는 TCP의 데이터 최대 길이  

  2. 타이밍 : 프로토콜 스택은 데이터가 모이지 않아도, 일정 시간 경과하면 패킷 송신 동작 실행  

- 데이터 양 중시 하면, 네트워크 효율을 높아지지만 버퍼에 머무는 시간 만큼 송신 지연
- 타이밍을 중시하면, 지연은 적어지지만 이용 효율이 떨어짐

### 2. 데이터가 클 때는 분할하여 보낸다.

- 데이터가 너무 길 경우에는 MSS의 크기에 맞게 분할, 분할한 조각을 한개씩 패킷에 넣어 송신한다.

### 3. ACK 번호를 사용하여 패킷이 도작 했는지 확인 한다.  

- 프로토콜스택의 TCP부분은 패킷이 상대에게 정상 도착했는지 확인하고, 도착하지 않으면 다시 송신하는 기능을 가지고 있다.

- 도착 확인 방법  
  1. 시퀀스 번호 : 데이터 조각의 갯수를 TCP 헤더에 기록
  
    EX) 수신측에서 1460 바이트까지 수신 완료, 그리고 1461번 까지 패킷이 도하면, 누락이 없다는 것을 확인 가능하다  
        수신 측에서 1460번째 바이트까지 수신 완료 후, 바로 시퀀스 번호가 2921인 패킷 도착하면 누락인것을 알수 있음.
      
    - 시퀀스 번호는 1부터 시작 하지 않고 난수 바탕으로 산출하기도 한다.  
      이는, 악의적 공격의 우려가 있기 때문,  
      송수신 시작 전에 초기값을 상대에게 알리도록 되어있음(SYN 비트를 1로 보낼때, 같이 설정)  

  2. ACK 번호 : 수신측으로 부터 반송 되었는지 확인
  
    - ACK번호가 상대로 부터 돌아오지 않으면 패킷을 다시 보낸다(회복처리)
    - 회복의 전망이 없다면(서버 다운) 송수신 동작 강제ㅐ 종료, 애플리케이션에 오류를 통지한다.  
  
### 4. 패킷 평균 왕복 시간으로 ACK 번호의 대기 시간을 조정한다.

- 타임 아웃 값 : ACK 가 돌아오는 대기시간   

- 지연되는 것을 예측, 어느정도 길게 설정  

- 대기 시간이 너무 길어지면 패킷을 다시 보내는 동작 지연, 속도 저하의 원인이 됨.  

- TCP는 대기 시간을 동적으로 변경하는 방법을 가지고 있음

- ACK 들어오는 시간 기준으로 대기시간 판단 및 설정한다

### 5. 윈도우 제어방식으로 효율적으로 ACK 번호를 관리한다.  

- 윈도우 제어 : 한개의 패킷을 보낸후, ACK 번호 반송을 기다리지 않고, 차례대로, 연속해서, 복수의 패킷을 보내는 방법

- 윈도우제어 방식의 개념 : 수신 측에서 송신측에 수신 가능한 데이터 양을 통지, 수신측의 이 양을 초과 하지 않도록 송신 동작 실행하는것.

- TCP 헤더의 윈도우 필드를 사용해서, 수신 버퍼에 충분히 비어있는 부분이 있다는것을 송신측에 알림

- 윈도우 사이즈 : 수신 가능한 데이터 양의 최대값 

### 6. ACK 번호와 윈도우를 합승한다.

- 윈도우 통지와, ACK 통지의 타이밍은 비슷함
  - ACK 통지 타이밍 : ACK는 수신측에서 데이터 수신후, 즉시 보냄.
  - 윈도우 통지 타이밍 : 송수신 버퍼에 빈영역이 생겨, 상호간에 윈도우 통지를 해야할때

- ACK를 송수신측 각각 통지하기 전에 기다렸다 윈도우 통지 발생시, 동시에 한 패킷에 묶어 송신측에 전송

- ACK 통지및, 윈도우 통지가 다량 발생하게 된다면, 마지막 것 외에 전부 생략한다.

### 7. HTTP 응답 메시지를 수신한다.

1. 수신 하기위해 read 호출
2. 프로토콜 스택이 수신 작동 (수신 버퍼에서 데이터를 추출 어플리케이션에 전달)
3. 송신 완료후, 얼마 안된 시점이라면, 데이터 전달 보류
4. 응답 패킷이 도착 했을때 마저 데이터 어플리케이션에 전달

- 프로토콜 스택이 데이터를 수신 하는 동작 정리
  - 데이터 수신시, 데이터 정상 수신 되었는지, TCP로 검사

  - 정상 수신시 송신 측으로 ACK 번호 발송

  - 수신 데이터는 수신 버퍼에 저장

  - 수신 버퍼 데이터를 추출, 어플리케이션에 전달

  - 어플리케이션 전달후, 타이밍 가늠, 윈도우를 송신측에 통지
